{% extends "base.html" %}
{% block title %}ğŸ’¬ Ntk ChatGPT{% endblock %}

{% block content %}
<div class="container">
    <h2>ğŸ’¬ TrÃ² chuyá»‡n vá»›i ChatGPT</h2>

    <form method="POST">
        <textarea name="prompt" placeholder="Nháº­p cÃ¢u há»i cá»§a báº¡n..." required>{{ prompt }}</textarea>
        <button type="submit">Gá»­i</button>
    </form>

   {% if prompt %}
    <div class="chat-log">
        <!-- User bubble -->
        <div class="chat-bubble user">
            <div class="label">ğŸ‘¤ Báº¡n:</div>
            <div class="message">{{ prompt }}</div>
        </div>

        <!-- GPT Ä‘ang gÃµ... -->
        <div id="typing-indicator" class="chat-bubble assistant">
            <div class="label">ğŸ¤– GPT:</div>
            <div class="message"><em>GPT Ä‘ang gÃµ...</em></div>
        </div>

        <!-- GPT tráº£ lá»i (áº©n khi Ä‘ang loading, hiá»‡n khi xong) -->
        <div id="gpt-response" class="chat-bubble assistant" style="display: none;">
            <div class="label">ğŸ¤– GPT:</div>
            <div class="message">{{ response }}</div>

            <div class="tools">
                <button class="copy-btn" onclick="copyContent(this)">ğŸ“‹ Copy</button>
                <button class="edit-btn" onclick="editContent(this)">âœï¸ Edit</button>
            </div>
        </div>
    </div>
    {% endif %}

</div>

<!-- Highlight.js + Markdown support -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>
    hljs.highlightAll();

    function copyContent(btn) {
        const content = btn.closest(".chat-bubble").querySelector(".message").innerText;
        navigator.clipboard.writeText(content);
        btn.innerText = "âœ… Copied";
        setTimeout(() => btn.innerText = "ğŸ“‹ Copy", 1500);
    }

    function editContent(btn) {
        const msgDiv = btn.closest(".chat-bubble").querySelector(".message");
        const original = msgDiv.innerText;
        const textarea = document.createElement("textarea");
        textarea.value = original;
        textarea.style.width = "100%";
        textarea.style.minHeight = "100px";
        msgDiv.innerHTML = "";
        msgDiv.appendChild(textarea);
        textarea.focus();

        btn.innerText = "ğŸ’¾ Save";
        btn.onclick = function () {
            msgDiv.innerText = textarea.value;
            btn.innerText = "âœï¸ Edit";
            btn.onclick = () => editContent(btn);
        };
    }
</script>
<!-- Highlight.js + Markdown content -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>
    // KÃ­ch hoáº¡t code highlight
    hljs.highlightAll();

    // Copy ná»™i dung
    function copyContent(btn) {
        const content = btn.closest(".chat-bubble").querySelector(".message").innerText;
        navigator.clipboard.writeText(content);
        btn.innerText = "âœ… Copied";
        setTimeout(() => btn.innerText = "ğŸ“‹ Copy", 1500);
    }

    // Cho phÃ©p chá»‰nh sá»­a ná»™i dung GPT
    function editContent(btn) {
        const msgDiv = btn.closest(".chat-bubble").querySelector(".message");
        const original = msgDiv.innerText;
        const textarea = document.createElement("textarea");
        textarea.value = original;
        textarea.style.width = "100%";
        textarea.style.minHeight = "120px";
        msgDiv.innerHTML = "";
        msgDiv.appendChild(textarea);
        textarea.focus();

        btn.innerText = "ğŸ’¾ Save";
        btn.onclick = function () {
            msgDiv.innerText = textarea.value;
            btn.innerText = "âœï¸ Edit";
            btn.onclick = () => editContent(btn);
        };
    }
</script>
<script>
    // Hiá»ƒn thá»‹ hiá»‡u á»©ng "GPT Ä‘ang gÃµ..." khoáº£ng 1.5s
    window.addEventListener("DOMContentLoaded", () => {
        const typing = document.getElementById("typing-indicator");
        const response = document.getElementById("gpt-response");

        if (typing && response) {
            setTimeout(() => {
                typing.style.display = "none";
                response.style.display = "block";
                hljs.highlightAll();
            }, 1500); // thá»i gian "Ä‘ang gÃµ"
        }
    });
</script>


{% endblock %}
