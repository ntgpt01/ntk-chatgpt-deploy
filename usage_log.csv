timestamp,username,prompt,response,total_tokens,prompt_tokens,completion_tokens

# Nh·∫≠n ph·∫£n h·ªìi t·ª´ GPT
response_text = completion.choices[0].message.content.strip()

# üî¢ L·∫•y th√¥ng tin token
usage = completion.usage
total_tokens = usage.total_tokens
prompt_tokens = usage.prompt_tokens
completion_tokens = usage.completion_tokens

# üßæ Ghi log ra file CSV
with open("usage_log.csv", "a", encoding="utf-8", newline="") as f:
    writer = csv.writer(f)
    writer.writerow([
        datetime.now().strftime("%Y-%m-%d %H:%M:%S"),  # th·ªùi gian
        session["username"],                           # username
        prompt.replace("\n", "\\n"),                   # prompt g·ªçn d√≤ng
        response_text.replace("\n", "\\n"),            # response g·ªçn d√≤ng
        total_tokens,                                  # t·ªïng token
        prompt_tokens,                                 # token c√¢u h·ªèi
        completion_tokens                              # token c√¢u tr·∫£ l·ªùi
    ])
2025-05-21 10:33:13,admin,hi,Hello! How can I assist you today?
2025-05-21 10:44:28,dona95,hi,Hello! How can I assist you today?,28,19,9
2025-05-21 10:44:31,dona95,hi,Hello! How can I assist you today?,28,19,9
2025-05-21 10:45:20,Ntk,hi,Hello! How can I assist you today?,28,19,9
2025-05-21 10:56:14,admin,ch√†o,Ch√†o b·∫°n! B·∫°n c√≥ kh·ªèe kh√¥ng? C√≥ g√¨ m√¨nh c√≥ th·ªÉ gi√∫p b·∫°n h√¥m nay?,39,20,19
